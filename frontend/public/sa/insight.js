!function(){var w=window,d=document,sc=d.currentScript||function(){var s=d.getElementsByTagName('script');return s[s.length-1]}(),sid=(sc&&sc.getAttribute&&sc.getAttribute('data-site'))||'';if(!sid||!w||!d)return;var LS=w.localStorage,SS=w.sessionStorage,st=30;try{st=parseInt(sc.getAttribute('data-session')||'30',10)||30}catch(e){}function rid(n){var a=new Uint8Array(n);(w.crypto||w.msCrypto).getRandomValues(a);for(var s='',i=0;i<a.length;i++)s+=String.fromCharCode(a[i]);return btoa(s).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'')}function key(p){return'sa_'+p+'_'+sid}function vid(){var k=key('vid'),v='';try{v=LS.getItem(k)||''}catch(e){}if(!v){v=rid(16);try{LS.setItem(k,v)}catch(e){}}return v}function sess(){var k=key('sess'),lk=key('last'),now=Date.now(),last=0;try{last=parseInt(SS.getItem(lk)||'0',10)||0}catch(e){}var ttl=st*60*1e3,s='';try{s=SS.getItem(k)||''}catch(e){}if(!s||!last||now-last>ttl){s=rid(12);try{SS.setItem(k,s)}catch(e){}}try{SS.setItem(lk,String(now))}catch(e){}return s}function dev(){var ua=navigator.userAgent||'';return/iPad|Tablet/.test(ua)?'tablet':/Mobile|Android|iP(hone|od)/.test(ua)?'mobile':'desktop'}function os(){var ua=navigator.userAgent||'';return/Windows/.test(ua)?'Windows':/Mac OS X/.test(ua)&&!/iPhone|iPad/.test(ua)?'macOS':/Android/.test(ua)?'Android':/iPhone|iPad|iPod/.test(ua)?'iOS':/Linux/.test(ua)?'Linux':'Other'}function br(){var ua=navigator.userAgent||'';return/Edg\//.test(ua)?'Edge':/Chrome\//.test(ua)&&!/Edg\//.test(ua)?'Chrome':/Firefox\//.test(ua)?'Firefox':/Safari\//.test(ua)&&!/Chrome\//.test(ua)?'Safari':'Other'}function tz(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone||''}catch(e){return''}}function regn(t){var p=(t||'').split('/');return p.length>1?p[0]:''}function chan(ref){try{if(!ref)return'Direct';var u=new URL(ref),h=u.hostname||'';if(/(google\.|bing\.|duckduckgo\.)/.test(h))return'Search';if(/(facebook\.|twitter\.|x\.com|t\.co|instagram\.|linkedin\.|tiktok\.)/.test(h))return'Social';return'Referral'}catch(e){return ref?'Referral':'Direct'}}function utm(){var o={};try{var p=new URLSearchParams(w.location.search),ks=['utm_source','utm_medium','utm_campaign','utm_term','utm_content'];for(var i=0;i<ks.length;i++){var v=p.get(ks[i]);if(v)o[ks[i]]=v}}catch(e){}return o}
// --- IndexedDB ---
var dbp=null;function openDb(){if(dbp)return dbp;dbp=new Promise(function(res){try{var r=indexedDB.open('sa_db',1);r.onupgradeneeded=function(){var db=r.result;if(!db.objectStoreNames.contains('sites')){var s=db.createObjectStore('sites',{keyPath:'id'});s.createIndex('domain','domain',{unique:!1});s.createIndex('createdAt','createdAt',{unique:!1})}if(!db.objectStoreNames.contains('hits')){var h=db.createObjectStore('hits',{keyPath:'id'});h.createIndex('siteId+ts',['siteId','ts'],{unique:!1});h.createIndex('siteId','siteId',{unique:!1});h.createIndex('ts','ts',{unique:!1});h.createIndex('type','type',{unique:!1});h.createIndex('url','url',{unique:!1});h.createIndex('channel','channel',{unique:!1});h.createIndex('browser','browser',{unique:!1});h.createIndex('os','os',{unique:!1});h.createIndex('deviceType','deviceType',{unique:!1});h.createIndex('countryHint','countryHint',{unique:!1});h.createIndex('visitorId','visitorId',{unique:!1});h.createIndex('sessionId','sessionId',{unique:!1})}};r.onsuccess=function(){res(r.result)};r.onerror=function(){res(null)};r.onblocked=function(){res(null)}}catch(e){res(null)}});return dbp}
function dbg(o){try{w.sa&&(w.sa._dbg=o)}catch(e){}}
function putHit(hit){return openDb().then(function(db){if(!db){dbg({op:'put',ok:!1,err:'no_db'});return!1}return new Promise(function(res){try{var tx=db.transaction('hits','readwrite');tx.oncomplete=function(){dbg({op:'put',ok:!0});res(!0)};tx.onerror=function(){dbg({op:'put',ok:!1,err:tx.error?String(tx.error):'tx_error'});res(!1)};tx.onabort=function(){dbg({op:'put',ok:!1,err:'abort'});res(!1)};tx.objectStore('hits').put(hit)}catch(e){dbg({op:'put',ok:!1,err:String(e)});res(!1)}})})}
function patchHit(id,p){return openDb().then(function(db){if(!db){dbg({op:'patch',ok:!1,err:'no_db'});return!1}return new Promise(function(res){try{var tx=db.transaction('hits','readwrite'),st=tx.objectStore('hits'),g=st.get(id);g.onsuccess=function(){var it=g.result;if(!it){dbg({op:'patch',ok:!1,err:'missing'});res(!1);return}for(var k in p)it[k]=p[k];st.put(it)};tx.oncomplete=function(){dbg({op:'patch',ok:!0});res(!0)};tx.onerror=function(){dbg({op:'patch',ok:!1,err:tx.error?String(tx.error):'tx_error'});res(!1)};tx.onabort=function(){dbg({op:'patch',ok:!1,err:'abort'});res(!1)}}catch(e){dbg({op:'patch',ok:!1,err:String(e)});res(!1)}})})}
function postSW(m){try{navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage(m)}catch(e){}}
function sendHit(h){putHit(h);postSW({kind:'SA_HIT',payload:h})}function patch(id,p){patchHit(id,p);postSW({kind:'SA_HIT_PATCH',id:id,patch:p||{}})}
var V=vid(),S=sess(),hitId='',scrollMax=0;function pv(){S=sess();var now=Date.now(),tzv=tz(),u=utm();hitId=rid(10)+'_'+now;sendHit({id:hitId,siteId:sid,type:'pageview',ts:now,url:w.location.href,title:d.title||'',referrer:d.referrer||'',visitorId:V,sessionId:S,durationMs:null,scrollMax:null,deviceType:dev(),browser:br(),os:os(),lang:navigator.language||'',tz:tzv,countryHint:regn(tzv),channel:chan(d.referrer||''),eventName:null,eventProps:null,utm_source:u.utm_source||null,utm_medium:u.utm_medium||null,utm_campaign:u.utm_campaign||null,utm_term:u.utm_term||null,utm_content:u.utm_content||null})}
function track(name,props){var now=Date.now(),tzv=tz();sendHit({id:rid(10)+'_'+now,siteId:sid,type:'event',ts:now,url:w.location.href,title:d.title||'',referrer:d.referrer||'',visitorId:V,sessionId:sess(),deviceType:dev(),browser:br(),os:os(),lang:navigator.language||'',tz:tzv,countryHint:regn(tzv),channel:chan(d.referrer||''),eventName:String(name||'event'),eventProps:props||null})}
function outbound(url){var now=Date.now(),tzv=tz();sendHit({id:rid(10)+'_'+now,siteId:sid,type:'outbound',ts:now,url:w.location.href,title:d.title||'',referrer:d.referrer||'',visitorId:V,sessionId:sess(),deviceType:dev(),browser:br(),os:os(),lang:navigator.language||'',tz:tzv,countryHint:regn(tzv),channel:chan(d.referrer||''),eventName:'outbound',eventProps:{to:url}})}
function onScroll(){var de=d.documentElement,stp=w.pageYOffset||de.scrollTop||0,h=de.scrollHeight-w.innerHeight,p=h>0?Math.min(100,Math.round(stp/h*100)):100;if(p>scrollMax)scrollMax=p}function onEnd(){try{if(!hitId)return;var started=parseInt(hitId.split('_')[1]||String(Date.now()),10),dur=Date.now()-started;patch(hitId,{durationMs:dur,scrollMax:scrollMax})}catch(e){}}
function hookHistory(){try{var ps=history.pushState,rs=history.replaceState;history.pushState=function(){ps.apply(history,arguments);setTimeout(pv,0)};history.replaceState=function(){rs.apply(history,arguments);setTimeout(pv,0)};w.addEventListener('popstate',function(){setTimeout(pv,0)})}catch(e){}}function hookClicks(){d.addEventListener('click',function(e){try{var a=e.target&&e.target.closest?e.target.closest('a'):null;if(!a||!a.href)return;var u=new URL(a.href);if(u.host&&u.host!==w.location.host)outbound(a.href)}catch(err){}},!0)}
try{navigator.serviceWorker&&navigator.serviceWorker.register&&navigator.serviceWorker.register('/sw.js',{scope:'/'}).catch(function(){})}catch(e){}
w.sa=w.sa||{};w.sa.track=track;w.sa.siteId=sid;hookHistory();hookClicks();w.addEventListener('scroll',onScroll,{passive:!0});w.addEventListener('visibilitychange',function(){if(d.visibilityState==='hidden')onEnd()});w.addEventListener('pagehide',onEnd);pv();}();
